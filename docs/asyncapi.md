# Verona Inferfaces Specification "Schemer" 0.1.0 documentation

This is one part of the Verona Online Assessment Standards. All messages are sent via the postMessage function of the html page. The schemer takes the page root of its parent as target (parent.window), and the application binds the function call to the iframe element of the schemer.
Most important, the message body carries as first parameter the operationId of the message.
The html page MUST contain a <script>-tag with metadata. The syntax and structure of this data are described [here](https://github.com/verona-interfaces/metadata/#readme).
## Table of Contents

* [Channels](#channels)

## Channels

### **vosReadyNotification** Channel

#### `subscribe` Operation

*Ready Notification*

The schemer announces that it's code is loaded and initialized so the communication can start.

##### Message

###### Payload

| Name | Type | Description | Accepted values |
|-|-|-|-|
| metadata **(required)** | string | Via this property, the schemer sends the stringified metadata object definied as json-ld in the header of the html file. See [here](https://github.com/verona-interfaces/metadata/#readme) for more information. | _Any_ |

> Examples of payload _(generated)_

```json
{
  "metadata": "string"
}
```




### **vosStartCommand** Channel

#### `publish` Operation

*Start Command*

The application sends parameters for editing the coding scheme and commands the start of user interaction.

##### Message

###### Payload

| Name | Type | Description | Accepted values |
|-|-|-|-|
| sessionId **(required)** | string | The session id flags all communication. If a message has no or empty session id, it's not processed. The session id is unique and was generated by the application. Any simple algorithm would work. The session id helps to link the correct unit with the data of the message. Using the id of the editor hosting html element is less reliable, because the element could be reused with another unit. | _Any_ |
| codingScheme | string | The coding scheme (if given) to be edited. | _Any_ |
| codingSchemeType | string | This lets the schemer the coding scheme format know. This might avoid UI mess after getting old schemes. | _Any_ |
| variables | arrayobject | Data of variables from unit definition. These variables represent the states of controls during assessment and form the basis of all coding. | _Any_ |
| variables.id **(required)** | string | - | _Any_ |
| variables.type **(required)** | string | Data type of the value. Additionally, the value might be of type `null` if `nullable` property below is set `true`. | string, integer, number, boolean |
| variables.format | string | Some more information to specify the data type of the value. Every editor might introduce special formats to support answer processing. One example at IQB is 'marking' to store text markings in the form of '85-113-orange'. | _Any_ |
| variables.multiple | boolean | If true, the value can contain multiple values as array of same type. | _Any_ |
| variables.nullable | boolean | If true, the value can be `null` instead of type above. In this case, the value `null` represents a response different to empty or 0. | _Any_ |
| variables.values | arrayobject | This list contains of possible values of the variable. | _Any_ |
| variables.values.value **(required)** | string | - | _Any_ |
| variables.values.label | string | Label to describe the value. If - for example - there are options to select and these options are stored as numbers 1/2/3 etc., the label can help to identify the selected option in dialogs and analyses. | _Any_ |
| variables.valuesComplete | boolean | If true, the list of possible values contains of ALL possible values. | _Any_ |
| schemerConfig | object | This data supplies some information or instruction about this specific scheming. | _Any_ |
| schemerConfig.definitionReportPolicy | string | The host expects the schemer to send all changes when happening or only on demand. The latter might lead to better performance. In this case (default), the host triggers report by sending 'vosGetSchemeRequest'. | eager, on-demand |

> Examples of payload _(generated)_

```json
{
  "sessionId": "idk8ur5jf9ru5jk",
  "codingScheme": "<CodingScheme> <Variable id=\"text-field_2\" label=\"text-field_2\"> <RuleBased> <Transform>DATE_TO_ISO</Transform> </RuleBased> <Code code=\"1\" score=\"11\" label=\"111\"> <Rule method=\"MATCH\"> <Parameter>2021-12-04</Parameter> </Rule> </Code> <Code code=\"2\" score=\"22\" label=\"222\"> <Rule method=\"MATCH\"> <Parameter>2022-12-04</Parameter> </Rule> </Code> </Variable> </CodingScheme>",
  "codingSchemeType": "iqb-standard@1.4.0",
  "variables": [
    {
      "id": "ME3491a",
      "type": "boolean",
      "format": "marking",
      "multiple": true,
      "nullable": true,
      "values": [
        {
          "value": "1",
          "label": "I love Berlin."
        }
      ],
      "valuesComplete": true
    }
  ],
  "schemerConfig": {
    "definitionReportPolicy": "eager"
  }
}
```




### **vosSchemeChangedNotification** Channel

#### `subscribe` Operation

*Scheme Changed Notification*

The conding scheme of the unit has changed.

##### Message

###### Payload

| Name | Type | Description | Accepted values |
|-|-|-|-|
| sessionId **(required)** | string | The session id flags all communication. If a message has no or empty session id, it's not processed. The session id is unique and was generated by the application. Any simple algorithm would work. The session id helps to link the correct unit with the data of the message. Using the id of the editor hosting html element is less reliable, because the element could be reused with another unit. | _Any_ |
| timeStamp **(required)** | string | Ensures, that later arriving states are ignored. | _Any_ |
| codingScheme | string | To be stored. | _Any_ |
| codingSchemeType | string | In order to understand the coding scheme outside the schemer, the type of the scheme should be known. This helps to select a suitable coder to run coding. | _Any_ |

> Examples of payload _(generated)_

```json
{
  "sessionId": "idk8ur5jf9ru5jk",
  "timeStamp": "2019-08-24T14:15:22Z",
  "codingScheme": "string",
  "codingSchemeType": "iqb-standard@1.4.0"
}
```




### **vosGetSchemeRequest** Channel

#### `publish` Operation

*Get Scheme Request*

The application wants the schemer to report the last state of the coding scheme. The schemer will answer by sending 'vosSchemeChangedNotification' with full payload.

##### Message

###### Payload

| Name | Type | Description | Accepted values |
|-|-|-|-|
| sessionId **(required)** | string | The session id flags all communication. If a message has no or empty session id, it's not processed. The session id is unique and was generated by the application. Any simple algorithm would work. The session id helps to link the correct unit with the data of the message. Using the id of the editor hosting html element is less reliable, because the element could be reused with another unit. | _Any_ |

> Examples of payload _(generated)_

```json
{
  "sessionId": "idk8ur5jf9ru5jk"
}
```




