# Verona Inferfaces Specification "Schemer" 2.0.0 documentation

* License: [CC BY-SA 4.0](https://creativecommons.org/licenses/by-sa/4.0/)
* Support: [Institute for Educational Quality Improvement (IQB)](https://www.iqb.hu-berlin.de)
* Email support: [iqb-tbadev@hu-berlin.de](mailto:iqb-tbadev@hu-berlin.de)

This is one part of the Verona Online Assessment Standards. All messages are sent via the postMessage function of the html page. The schemer takes the page root of its parent as target (parent.window), and the application binds the function call to the iframe element of the schemer.
Most important, the message body carries as first parameter the operationId of the message.
The html page MUST contain a script-tag with metadata. The syntax and structure of this data are described [here](https://github.com/verona-interfaces/metadata/#readme).

## Table of Contents

* [Operations](#operations)
  * [SUB vosReadyNotification](#sub-vosreadynotification-operation)
  * [PUB vosStartCommand](#pub-vosstartcommand-operation)
  * [SUB vosSchemeChangedNotification](#sub-vosschemechangednotification-operation)

## Operations

### SUB `vosReadyNotification` Operation

*Ready Notification*

* Operation ID: `vosReadyNotification`

The schemer announces that it's code is loaded and initialized so the communication can start.

#### Message `vosReadyNotification`

##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | - | - | **additional properties are allowed** |
| metadata | string | Via this property, the schemer sends the stringified metadata object definied as json-ld in the header of the html file. See [here](https://github.com/verona-interfaces/metadata/#readme) for more information. | - | - | **required** |

> Examples of payload _(generated)_

```json
{
  "metadata": "string"
}
```



### PUB `vosStartCommand` Operation

*Start Command*

* Operation ID: `vosStartCommand`

The application sends parameters for editing the coding scheme and commands the start of user interaction.

#### Message `vosStartCommand`

* Content type: [application/json](https://www.iana.org/assignments/media-types/application/json)

##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | - | - | **additional properties are allowed** |
| sessionId | string | The session id flags all communication. If a message has no or empty session id, it's not processed. The session id is unique and was generated by the application. Any simple algorithm would work. The session id helps to link the correct unit with the data of the message. Using the id of the editor hosting html element is less reliable, because the element could be reused with another unit. | - | - | **required** |
| codingScheme | string | The coding scheme (if given) to be edited. | - | format (`byte`) | - |
| codingSchemeType | string | This lets the schemer the coding scheme format know. This might avoid UI mess after getting old schemes. | - | - | - |
| variables | array<object> | Data of variables from unit definition. These variables represent the states of controls during assessment and form the basis of all coding. We call these variables 'base variables'. | - | - | - |
| variables.id | string | - | - | - | **required** |
| variables.label | string | - | - | - | - |
| variables.page | string | The location of the value source if available. | - | - | - |
| schemerConfig | object | - | - | - | **additional properties are allowed** |
| schemerConfig.directDownloadUrl | string | After starting the schemer and loading the scheme, it might be necessary to load additional code or data from the server. This data is identified by an resource ID (usually a file name). The schemer can download this resource by itself without further interaction with the host frontend. The property directDownloadUrl provides the url for download. The schemer extends this url by an url separator "/" and the resource ID (uri-encoded if needed). | - | - | - |

> Examples of payload _(generated)_

```json
{
  "sessionId": "idk8ur5jf9ru5jk",
  "codingScheme": "<CodingScheme> <Variable id=\"text-field_2\" label=\"text-field_2\"> <RuleBased> <Transform>DATE_TO_ISO</Transform> </RuleBased> <Code code=\"1\" score=\"11\" label=\"111\"> <Rule method=\"MATCH\"> <Parameter>2021-12-04</Parameter> </Rule> </Code> <Code code=\"2\" score=\"22\" label=\"222\"> <Rule method=\"MATCH\"> <Parameter>2022-12-04</Parameter> </Rule> </Code> </Variable> </CodingScheme>",
  "codingSchemeType": "iqb@1.0",
  "variables": [
    {
      "id": "ME3491a",
      "label": "Part of item 3 b)",
      "page": "Part of item 3 b)"
    }
  ],
  "schemerConfig": {
    "directDownloadUrl": "https://www.iqb-supercoder.de/download/iskeid-34e845-didmmemdkek"
  }
}
```



### SUB `vosSchemeChangedNotification` Operation

*Scheme Changed Notification*

* Operation ID: `vosSchemeChangedNotification`

The coding scheme of the unit has changed.

#### Message `vosSchemeChangedNotification`

* Content type: [application/json](https://www.iana.org/assignments/media-types/application/json)

##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | - | - | **additional properties are allowed** |
| sessionId | string | The session id flags all communication. If a message has no or empty session id, it's not processed. The session id is unique and was generated by the application. Any simple algorithm would work. The session id helps to link the correct unit with the data of the message. Using the id of the editor hosting html element is less reliable, because the element could be reused with another unit. | - | - | **required** |
| timeStamp | string | Ensures, that later arriving states are ignored. | - | format (`date-time`) | **required** |
| codingScheme | string | To be stored. | - | format (`byte`) | **required** |
| codingSchemeType | string | In order to understand the coding scheme outside the schemer, the type of the scheme should be known. This helps to select a suitable coder to run coding. | - | - | **required** |
| variables | array<object> | List of all variables from coding scheme including derived variables. Reading this might be important even for base variables, because as part of the coding scheme, a label can be given for all variables. | - | - | - |
| variables.id | string | - | - | - | **required** |
| variables.label | string | - | - | - | - |
| variables.page | string | The location of the value source if available. | - | - | - |
| dependenciesToCode | array<object> | Files to provide or services to keep accessible during the coding of responses to the items of the unit. | - | - | - |
| dependenciesToCode.id | string | - | - | - | **required** |
| dependenciesToCode.type | string | - | allowed (`"file"`, `"service"`) | - | **required** |

> Examples of payload _(generated)_

```json
{
  "sessionId": "idk8ur5jf9ru5jk",
  "timeStamp": "2019-08-24T14:15:22Z",
  "codingScheme": "string",
  "codingSchemeType": "iqb@1.0",
  "variables": [
    {
      "id": "ME3491a",
      "label": "Part of item 3 b)",
      "page": "Part of item 3 b)"
    }
  ],
  "dependenciesToCode": [
    {
      "id": "https://short-answer-supercoder.iqb-berlin.de",
      "type": "file"
    }
  ]
}
```



